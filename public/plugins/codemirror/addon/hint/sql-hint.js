!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],t):t(CodeMirror)}(function(t){function e(t){return"[object Array]"==Object.prototype.toString.call(t)}function r(e){return"sql"===(e=e.doc.modeOption)&&(e="text/x-sql"),t.resolveMode(e).keywords}function n(e){return"sql"===(e=e.doc.modeOption)&&(e="text/x-sql"),t.resolveMode(e).identifierQuote||"`"}function o(t){return"string"==typeof t?t:t.text}function i(t,r){return e(r)&&(r={columns:r}),r.text||(r.text=t),r}function s(t){var r={};if(e(t))for(var n=t.length-1;0<=n;n--){var s=t[n];r[o(s).toUpperCase()]=i(o(s),s)}else if(t)for(n in t)r[n.toUpperCase()]=i(n,t[n]);return r}function a(t){var e,r={};for(e in t)t.hasOwnProperty(e)&&(r[e]=t[e]);return r}function l(t,e){var r=t.length;return r=o(e).substr(0,r),t.toUpperCase()===r.toUpperCase()}function u(t,r,n,o){if(e(n))for(var i=0;i<n.length;i++)l(r,n[i])&&t.push(o(n[i]));else for(i in n)if(n.hasOwnProperty(i)){var s=n[i];l(r,s=s&&!0!==s?s.displayText?{text:s.text,displayText:s.displayText}:s.text:i)&&t.push(o(s))}}function f(t){"."==t.charAt(0)&&(t=t.substr(1)),t=t.split(v+v);for(var e=0;e<t.length;e++)t[e]=t[e].replace(new RegExp(v,"g"),"");return t.join(v)}function c(t){for(var e=o(t).split("."),r=0;r<e.length;r++)e[r]=v+e[r].replace(new RegExp(v,"g"),v+v)+v;return e=e.join("."),"string"==typeof t?e:((t=a(t)).text=e,t)}function p(t,e){for(var r=t.split(/\s+/),n=0;n<r.length;n++)r[n]&&e(r[n].replace(/[,;]/g,""))}function d(t,e){for(var r=e.doc,n=r.getValue(),o=t.toUpperCase(),i="",s="",a=[],l=C(0,0),u=C(e.lastLine(),e.getLineHandle(e.lastLine()).length),f=n.indexOf(m.QUERY_DIV);-1!=f;)a.push(r.posFromIndex(f)),f=n.indexOf(m.QUERY_DIV,f+1);a.unshift(C(0,0)),a.push(C(e.lastLine(),e.getLineHandle(e.lastLine()).text.length)),f=null;var c=e.getCursor();for(n=0;n<a.length;n++){if((null==f||0<y(c,f))&&0>=y(c,a[n])){l=f,u=a[n];break}f=a[n]}if(l)for(r=r.getRange(l,u,!1),n=0;n<r.length&&(p(r[n],function(t){var e=t.toUpperCase();e===o&&g[i.toUpperCase()]&&(s=i),e!==m.ALIAS_KEYWORD&&(i=t)}),!s);n++);return s}var g,h,x,v,m={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},C=t.Pos,y=t.cmpPos;t.registerHelper("hint","sql",function(t,e){g=s(e&&e.tables);var o=e&&e.defaultTable,i=e&&e.disableKeywords;h=o&&g[o.toUpperCase()],x=r(t),v=n(t),o&&!h&&(h=d(o,t)),(h=h||[]).columns&&(h=h.columns),o=t.getCursor();var l=[],p=t.getTokenAt(o);if(p.end>o.ch&&(p.end=o.ch,p.string=p.string.slice(0,o.ch-p.start)),p.string.match(/^[.`"\w@]\w*$/))var m=p.string,y=p.start,b=p.end;else y=b=o.ch,m="";if("."==m.charAt(0)||m.charAt(0)==v)y=function(t,e,r,n){for(var o=!1,i=[],s=e.start,l=!0;l;)l="."==e.string.charAt(0),o=o||e.string.charAt(0)==v,s=e.start,i.unshift(f(e.string)),"."==(e=n.getTokenAt(C(t.line,e.start))).string&&(l=!0,e=n.getTokenAt(C(t.line,e.start)));u(r,t=i.join("."),g,function(t){return o?c(t):t}),u(r,t,h,function(t){return o?c(t):t}),t=i.pop();var p=i.join("."),x=!1,m=p;return g[p.toUpperCase()]||(i=p,(p=d(p,n))!==i&&(x=!0)),(n=g[p.toUpperCase()])&&n.columns&&(n=n.columns),n&&u(r,t,n,function(t){var e=p;return 1==x&&(e=m),"string"==typeof t?t=e+"."+t:(t=a(t)).text=e+"."+t.text,o?c(t):t}),s}(o,p,l,t);else{var A=function(t,e){return"object"==typeof t?t.className=e:t={text:t,className:e},t};u(l,m,h,function(t){return A(t,"CodeMirror-hint-table CodeMirror-hint-default-table")}),u(l,m,g,function(t){return A(t,"CodeMirror-hint-table")}),i||u(l,m,x,function(t){return A(t.toUpperCase(),"CodeMirror-hint-keyword")})}return{list:l,from:C(o.line,y),to:C(o.line,b)}})});