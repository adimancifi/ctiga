!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){function e(t,e,r){return r?0<=t.indexOf(e):0==t.lastIndexOf(e,0)}var r=t.Pos;t.registerHelper("hint","xml",function(n,s){var i=s&&s.schemaInfo,a=s&&s.quoteChar||'"',o=s&&s.matchInMiddle;if(i){var l=n.getCursor(),g=n.getTokenAt(l);g.end>l.ch&&(g.end=l.ch,g.string=g.string.slice(0,l.ch-g.start));var f=t.innerMode(n.getMode(),g.state);if("xml"==f.mode.name){var c,h=[],p=!1,u=/\btag\b/.test(g.type)&&!/>$/.test(g.string),d=u&&/^\w/.test(g.string);if(d){var m=n.getLine(l.line).slice(Math.max(0,g.start-2),g.start);(m=/<\/$/.test(m)?"close":/<$/.test(m)?"open":null)&&(c=g.start-("close"==m?2:1))}else u&&"<"==g.string?m="open":u&&"</"==g.string&&(m="close");if(!u&&!f.state.tagName||m){if(d)var y=g.string;p=m,f=(a=f.state.context)&&i[a.tagName];var v=a?f&&f.children:i["!top"];if(v&&"close"!=m)for(i=0;i<v.length;++i)y&&!e(v[i],y,o)||h.push("<"+v[i]);else if("close"!=m)for(var b in i)!i.hasOwnProperty(b)||"!top"==b||"!attrs"==b||y&&!e(b,y,o)||h.push("<"+b);a&&(!y||"close"==m&&e(a.tagName,y,o))&&h.push("</"+a.tagName+">")}else{if(b=(f=i[f.state.tagName])&&f.attrs,i=i["!attrs"],!b&&!i)return;if(b){if(i){for(var x in m={},i)i.hasOwnProperty(x)&&(m[x]=i[x]);for(x in b)b.hasOwnProperty(x)&&(m[x]=b[x]);b=m}}else b=i;if("string"==g.type||"="==g.string){if(!(i=(m=n.getRange(r(l.line,Math.max(0,l.ch-60)),r(l.line,"string"==g.type?g.start:g.end))).match(/([^\s\u00a0=<>"']+)=$/))||!b.hasOwnProperty(i[1])||!(v=b[i[1]]))return;for("function"==typeof v&&(v=v.call(this,n)),"string"==g.type&&(y=g.string,p=0,/['"]/.test(g.string.charAt(0))&&(a=g.string.charAt(0),y=g.string.slice(1),p++),i=g.string.length,/['"]/.test(g.string.charAt(i-1))&&(a=g.string.charAt(i-1),y=g.string.substr(p,i-2)),p&&((p=n.getLine(l.line)).length>g.end&&p.charAt(g.end)==a&&g.end++),p=!0),i=0;i<v.length;++i)y&&!e(v[i],y,o)||h.push(a+v[i]+a)}else for(var O in"attribute"==g.type&&(y=g.string,p=!0),b)!b.hasOwnProperty(O)||y&&!e(O,y,o)||h.push(O)}return{list:h,from:p?r(l.line,null==c?g.start:c):l,to:p?r(l.line,g.end):l}}}})});